-- ------------------------------------------------
-- 집계함수
     - 집계 함수는 단일 행이 아닌 행 그룹을 기반으로 단일 결과 행을 반환
     - 집계 함수는 SELECT 절, ORDER BY 및 HAVING 절에서 사용할 수 있으며, WHERE 절에서는 사용 할 수 없다.
     - 일반적으로 집계 함수는 GROUP BY 절과 같이 사용되지만 테이블 전체가 하나의 그룹이 되는 경우에는 GROUP BY 절 없이 단독으로 사용 가능
     - GROUP BY 절에서 사용하지 않은 컬럼은 집계 합수와 함께 사용할 수 없다.
     - COUNT(*), GROUPING 및 GROUPING_ID를 제외한 모든 집계 함수는 NULL을 무시

     - COUNT : 행의 개수를 리턴
     - AVG : NULL값을 제외한 행의 평균값을 출력한다.
     - SUM : NULL값을 제외한 합계를 출력한다.
     - MAX : 최대값을 출력한다.
     - MIN : 최소값을 출력한다.

     - GROUP BY 절 : 데이터들을 작은 그룹으로 분류하여 소 그룹에 대한 항목별로 통계 정보를 얻을 때 추가로 사용
     - HAVING 절 : 집계 함수를 사용하여 조회 된 테이블 또는 뷰의 개별 행 값이 아니라 집계 함수의 결과를 기반으로 출력에서 그룹을 제거


-- ------------------------------------------------
-- 분석함수
   - 순위 계산
      RANK() OVER(
          [PARTITION BY ] [,...]
          ORDER BY  [collate clause] [ASC | DESC]
          [NULLS FIRST | NULLS LAST]);

      ROW_NUMBER() OVER( 
          [PARTITION BY ] [,...]
          ORDER BY  [collate clause] [ASC | DESC]
          [NULLS FIRST | NULLS LAST]);

     그룹 내에서 위치를 반환한다. RANK() OVER()는 동일한 값인 경우 1,1,3 형식으로 순위를 계산하지만 ROW_NUMBER() OVER()는 동일한 값인 경우 1,2,3 현식으로 순위를 계산한다.


   - COUNT() OVER(), SUM() OVER(), AVG() OVER(), MAX() OVER(), MIN() OVER() 함수
      -- 여러행이 출력

      -- 전체 인원수, 전체 평균
          SELECT name, dept, sal, 
               COUNT(*) OVER() cnt,
               ROUND(AVG(sal) OVER()) ave
          FROM emp;

      -- 부서별 인원수, 부서별 평균
          SELECT name, dept, sal, 
               COUNT(*) OVER(PARTITION BY dept) cnt,
               ROUND(AVG(sal) OVER(PARTITION BY dept)) ave
          FROM emp;


   - RATIO_TO_REPORT() OVER() 함수 : 비율
      SELECT dept, ROUND(RATIO_TO_REPORT(COUNT(*)) OVER() * 100) 비율
      FROM emp
      GROUP BY dept;


   - LISTAGG () WITHIN GROUP() 함수 : 컬럼의 값을 구분자로 결합
      -- 컬럼의 내용을 그룹화 하여 구분자(,)로 구분 가로로 나열. 나열 순서는 GROUP(ORDER BY 나열규칙) 에 기술
          SELECT dept, LISTAGG(name, ',') WITHIN GROUP(ORDER BY empNo) "부서별사원명"
          FROM emp
          GROUP BY dept;  -- GROUP BY 절 생략 불가


